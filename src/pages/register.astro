---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Crear Cuenta - Numérica">
	<div class="auth-page">
		<div class="container">
			<div class="auth-container">
				<div class="auth-card card">
					<div class="card-header">
						<h1 class="auth-title">Crear Cuenta</h1>
						<p class="auth-subtitle">Regístrate para participar en las subastas de maquinaria industrial</p>
					</div>

					<div class="card-body">
						<form id="registerForm" class="auth-form">
							<div class="form-group">
								<label for="name" class="form-label">Nombre Completo</label>
								<input 
									type="text" 
									id="name" 
									name="name" 
									required 
									placeholder="Ej: Juan Pérez"
									class="form-input"
								/>
							</div>

							<div class="form-group">
								<label for="phone" class="form-label">Número de Teléfono</label>
								<input 
									type="tel" 
									id="phone" 
									name="phone" 
									required 
									placeholder="Ej: 5551234567" 
									class="form-input"
								/>
								<small class="form-help">Este será tu nombre de usuario para iniciar sesión</small>
							</div>

							<div class="form-group">
								<label for="password" class="form-label">Contraseña</label>
								<input 
									type="password" 
									id="password" 
									name="password" 
									required 
									minlength="6" 
									class="form-input"
								/>
								<small class="form-help">Mínimo 6 caracteres</small>
							</div>

							<div class="form-group">
								<label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
								<input 
									type="password" 
									id="confirmPassword" 
									name="confirmPassword" 
									required 
									minlength="6" 
									class="form-input"
								/>
							</div>

							<div class="form-group">
								<label class="checkbox-label">
									<input type="checkbox" id="terms" required class="checkbox-input" />
									<span class="checkbox-text">
										Acepto los <a href="#" class="auth-link">términos y condiciones</a> 
										y la <a href="#" class="auth-link">política de privacidad</a>
									</span>
								</label>
							</div>

							<button type="submit" class="btn btn-primary" style="width: 100%;" id="submitBtn">
								Crear Cuenta
							</button>
						</form>

						<div id="message" class="alert" style="display: none;"></div>
					</div>

					<div class="card-footer">
						<p class="auth-footer-text">
							¿Ya tienes cuenta? 
							<a href="/login" class="auth-link">Iniciar sesión</a>
						</p>
					</div>
				</div>

				<div class="auth-help">
					<div class="help-card card">
						<div class="card-body">
							<h3>¿Por qué registrarse?</h3>
							<ul class="benefits-list">
								<li>
									<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M9 12l2 2 4-4"/>
										<circle cx="12" cy="12" r="10"/>
									</svg>
									Participa en subastas en tiempo real
								</li>
								<li>
									<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M9 12l2 2 4-4"/>
										<circle cx="12" cy="12" r="10"/>
									</svg>
									Acceso a maquinaria industrial certificada
								</li>
								<li>
									<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M9 12l2 2 4-4"/>
										<circle cx="12" cy="12" r="10"/>
									</svg>
									Historial de pujas y transacciones
								</li>
								<li>
									<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M9 12l2 2 4-4"/>
										<circle cx="12" cy="12" r="10"/>
									</svg>
									Notificaciones de nuevas subastas
								</li>
							</ul>
						</div>
					</div>

					<div class="security-card card">
						<div class="card-body">
							<h3>Seguridad</h3>
							<p class="security-text">
								Tus datos están protegidos con encriptación de nivel bancario. 
								Nunca compartimos tu información personal con terceros.
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</Layout>

<style>
	.auth-page {
		min-height: calc(100vh - 140px);
		display: flex;
		align-items: center;
		padding: 2rem 0;
		background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
	}

	.auth-container {
		display: grid;
		grid-template-columns: 1fr auto;
		gap: 2rem;
		align-items: start;
		max-width: 900px;
		margin: 0 auto;
	}

	.auth-card {
		width: 100%;
		max-width: 450px;
	}

	.auth-title {
		font-size: 1.875rem;
		font-weight: 700;
		color: var(--gray-900);
		margin-bottom: 0.5rem;
		text-align: center;
	}

	.auth-subtitle {
		color: var(--gray-600);
		text-align: center;
		margin: 0;
		line-height: 1.5;
	}

	.auth-form {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.form-help {
		font-size: 0.875rem;
		color: var(--gray-500);
		margin-top: 0.25rem;
	}

	.checkbox-label {
		display: flex;
		align-items: flex-start;
		gap: 0.75rem;
		cursor: pointer;
		font-size: 0.875rem;
		line-height: 1.5;
	}

	.checkbox-input {
		margin: 0;
		width: 16px;
		height: 16px;
		flex-shrink: 0;
		margin-top: 0.125rem;
	}

	.checkbox-text {
		color: var(--gray-600);
	}

	.auth-footer-text {
		text-align: center;
		color: var(--gray-600);
		margin: 0;
	}

	.auth-link {
		color: var(--primary-color);
		text-decoration: none;
		font-weight: 500;
	}

	.auth-link:hover {
		text-decoration: underline;
	}

	.auth-help {
		width: 300px;
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.help-card h3,
	.security-card h3 {
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--gray-900);
		margin-bottom: 1rem;
	}

	.benefits-list {
		list-style: none;
		padding: 0;
		margin: 0;
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.benefits-list li {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		font-size: 0.875rem;
		color: var(--gray-600);
	}

	.benefits-list svg {
		color: var(--success-color);
		flex-shrink: 0;
	}

	.security-text {
		font-size: 0.875rem;
		color: var(--gray-600);
		line-height: 1.5;
		margin: 0;
	}

	@media (max-width: 768px) {
		.auth-container {
			grid-template-columns: 1fr;
			gap: 1.5rem;
		}

		.auth-help {
			width: 100%;
		}

		.auth-card {
			max-width: none;
		}
	}
</style>

<script>
	document.getElementById('registerForm').addEventListener('submit', async (e) => {
		e.preventDefault();
		
		const submitBtn = document.getElementById('submitBtn');
		const messageDiv = document.getElementById('message');
		
		const formData = new FormData(e.target);
		const name = formData.get('name');
		const phone = formData.get('phone');
		const password = formData.get('password');
		const confirmPassword = formData.get('confirmPassword');

		// Validate passwords match
		if (password !== confirmPassword) {
			showMessage('Las contraseñas no coinciden', 'error');
			return;
		}

		// Validate terms acceptance
		if (!document.getElementById('terms').checked) {
			showMessage('Debes aceptar los términos y condiciones', 'error');
			return;
		}

		submitBtn.disabled = true;
		submitBtn.textContent = 'Creando cuenta...';
		messageDiv.style.display = 'none';

		try {
			const response = await fetch('/api/auth/register', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ name, phone, password }),
			});

			const data = await response.json();

			if (data.success) {
				showMessage('Cuenta creada exitosamente. Redirigiendo...', 'success');
				setTimeout(() => {
					window.location.href = '/login';
				}, 2000);
			} else {
				showMessage(data.error || 'Error al crear la cuenta', 'error');
			}
		} catch (error) {
			showMessage('Error de conexión. Intenta nuevamente.', 'error');
		} finally {
			submitBtn.disabled = false;
			submitBtn.textContent = 'Crear Cuenta';
		}
	});

	function showMessage(text, type) {
		const messageDiv = document.getElementById('message');
		messageDiv.textContent = text;
		messageDiv.className = `alert alert-${type}`;
		messageDiv.style.display = 'block';
	}

	// Real-time password confirmation validation
	document.getElementById('confirmPassword').addEventListener('input', function() {
		const password = document.getElementById('password').value;
		const confirmPassword = this.value;
		
		if (confirmPassword && password !== confirmPassword) {
			this.setCustomValidity('Las contraseñas no coinciden');
		} else {
			this.setCustomValidity('');
		}
	});
</script>