---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Iniciar Sesión - Numérica">
	<div class="auth-page">
		<div class="container">
			<div class="auth-container">
				<div class="auth-card card">
					<div class="card-header">
						<h1 class="auth-title">Iniciar Sesión</h1>
						<p class="auth-subtitle">Accede a tu cuenta para participar en las subastas</p>
					</div>

					<div class="card-body">
						<form id="loginForm" class="auth-form">
							<div class="form-group">
								<label for="phone" class="form-label">Número de Teléfono</label>
								<input 
									type="tel" 
									id="phone" 
									name="phone" 
									required 
									placeholder="Ej: 5551234567" 
									class="form-input"
								/>
							</div>

							<div class="form-group">
								<label for="password" class="form-label">Contraseña</label>
								<input 
									type="password" 
									id="password" 
									name="password" 
									required 
									class="form-input"
								/>
							</div>

							<button type="submit" class="btn btn-primary" style="width: 100%;" id="submitBtn">
								Iniciar Sesión
							</button>
						</form>

						<div id="message" class="alert" style="display: none;"></div>
					</div>

					<div class="card-footer">
						<p class="auth-footer-text">
							¿No tienes cuenta? 
							<a href="/register" class="auth-link">Crear cuenta</a>
						</p>
					</div>
				</div>

				<div class="auth-help">
					<div class="help-card card">
						<div class="card-body">
							<h3>Credenciales de Prueba</h3>
							<div class="test-credentials">
								<div class="credential-item">
									<strong>Usuario de prueba:</strong>
									<div class="credential-details">
										<span>Teléfono: 5551234567</span>
										<span>Contraseña: test123</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</Layout>

<style>
	.auth-page {
		min-height: calc(100vh - 140px);
		display: flex;
		align-items: center;
		padding: 2rem 0;
		background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
	}

	.auth-container {
		display: grid;
		grid-template-columns: 1fr auto;
		gap: 2rem;
		align-items: start;
		max-width: 900px;
		margin: 0 auto;
	}

	.auth-card {
		width: 100%;
		max-width: 450px;
	}

	.auth-title {
		font-size: 1.875rem;
		font-weight: 700;
		color: var(--gray-900);
		margin-bottom: 0.5rem;
		text-align: center;
	}

	.auth-subtitle {
		color: var(--gray-600);
		text-align: center;
		margin: 0;
	}

	.auth-form {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.auth-footer-text {
		text-align: center;
		color: var(--gray-600);
		margin: 0;
	}

	.auth-link {
		color: var(--primary-color);
		text-decoration: none;
		font-weight: 500;
	}

	.auth-link:hover {
		text-decoration: underline;
	}

	.auth-help {
		width: 300px;
	}

	.help-card h3 {
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--gray-900);
		margin-bottom: 1rem;
	}

	.test-credentials {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.credential-item {
		padding: 1rem;
		background: var(--gray-50);
		border-radius: var(--border-radius);
		border: 1px solid var(--gray-200);
	}

	.credential-item strong {
		display: block;
		margin-bottom: 0.5rem;
		color: var(--gray-900);
	}

	.credential-details {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		font-size: 0.875rem;
		color: var(--gray-600);
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
	}

	@media (max-width: 768px) {
		.auth-container {
			grid-template-columns: 1fr;
			gap: 1.5rem;
		}

		.auth-help {
			width: 100%;
		}

		.auth-card {
			max-width: none;
		}
	}
</style>

<script>
	document.getElementById('loginForm').addEventListener('submit', async (e) => {
		e.preventDefault();
		
		const submitBtn = document.getElementById('submitBtn');
		const messageDiv = document.getElementById('message');
		
		const formData = new FormData(e.target);
		const phone = formData.get('phone');
		const password = formData.get('password');

		submitBtn.disabled = true;
		submitBtn.textContent = 'Iniciando sesión...';
		messageDiv.style.display = 'none';

		try {
			const response = await fetch('/api/auth/login', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ phone, password }),
			});

			const data = await response.json();

			if (data.success) {
				// Store user data and token
				localStorage.setItem('userToken', data.token);
				localStorage.setItem('userData', JSON.stringify(data.user));
				
				showMessage('Inicio de sesión exitoso. Redirigiendo...', 'success');
				setTimeout(() => {
					window.location.href = '/subastas';
				}, 1500);
			} else {
				showMessage(data.error || 'Error en el inicio de sesión', 'error');
			}
		} catch (error) {
			showMessage('Error de conexión. Intenta nuevamente.', 'error');
		} finally {
			submitBtn.disabled = false;
			submitBtn.textContent = 'Iniciar Sesión';
		}
	});

	function showMessage(text, type) {
		const messageDiv = document.getElementById('message');
		messageDiv.textContent = text;
		messageDiv.className = `alert alert-${type}`;
		messageDiv.style.display = 'block';
	}
</script>